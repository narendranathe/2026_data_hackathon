<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026 State of Data Engineering ‚Äî Hidden Patterns Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<style>
  :root {
    --bg: #0f111a;
    --surface: #1a1d2e;
    --surface2: #232740;
    --border: #2e3348;
    --text: #e2e4f0;
    --text2: #8b8fa8;
    --accent: #6c5ce7;
    --accent2: #00cec9;
    --accent3: #fd79a8;
    --accent4: #fdcb6e;
    --accent5: #55efc4;
    --danger: #ff6b6b;
    --success: #51cf66;
    --warn: #fcc419;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
  }

  .hero {
    background: linear-gradient(135deg, #1a1040 0%, #0f111a 50%, #0a1628 100%);
    padding: 60px 24px 40px;
    text-align: center;
    border-bottom: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .hero::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at 30% 50%, rgba(108,92,231,0.08) 0%, transparent 50%),
                radial-gradient(circle at 70% 50%, rgba(0,206,201,0.06) 0%, transparent 50%);
    pointer-events: none;
  }

  .hero h1 {
    font-size: clamp(28px, 4vw, 44px);
    font-weight: 800;
    letter-spacing: -1px;
    margin-bottom: 12px;
    background: linear-gradient(135deg, #e2e4f0, #6c5ce7, #00cec9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
  }

  .hero p {
    color: var(--text2);
    font-size: 16px;
    max-width: 680px;
    margin: 0 auto 20px;
    position: relative;
  }

  .hero .tag {
    display: inline-block;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 13px;
    color: var(--accent2);
    position: relative;
  }

  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 24px;
  }

  .section-title {
    font-size: 22px;
    font-weight: 700;
    margin: 40px 0 8px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-title .num {
    background: var(--accent);
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 800;
    flex-shrink: 0;
  }

  .section-desc {
    color: var(--text2);
    font-size: 14px;
    margin-bottom: 20px;
    max-width: 800px;
  }

  .grid { display: grid; gap: 20px; }
  .grid-2 { grid-template-columns: repeat(auto-fit, minmax(min(100%, 500px), 1fr)); }
  .grid-3 { grid-template-columns: repeat(auto-fit, minmax(min(100%, 360px), 1fr)); }
  .grid-4 { grid-template-columns: repeat(auto-fit, minmax(min(100%, 260px), 1fr)); }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    transition: border-color 0.2s;
  }

  .card:hover { border-color: var(--accent); }

  .card-title {
    font-size: 14px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text2);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-title .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .chart-container {
    position: relative;
    width: 100%;
    min-height: 300px;
  }

  .chart-container canvas {
    max-width: 100%;
  }

  .kpi-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .kpi {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .kpi::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }

  .kpi:nth-child(1)::before { background: var(--accent); }
  .kpi:nth-child(2)::before { background: var(--accent2); }
  .kpi:nth-child(3)::before { background: var(--accent3); }
  .kpi:nth-child(4)::before { background: var(--accent4); }
  .kpi:nth-child(5)::before { background: var(--accent5); }

  .kpi-value {
    font-size: 36px;
    font-weight: 800;
    letter-spacing: -1px;
  }

  .kpi-label {
    font-size: 12px;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 4px;
  }

  .kpi-sub {
    font-size: 11px;
    color: var(--text2);
    margin-top: 6px;
    font-style: italic;
  }

  .insight-box {
    background: linear-gradient(135deg, rgba(108,92,231,0.1), rgba(0,206,201,0.05));
    border: 1px solid rgba(108,92,231,0.3);
    border-radius: 10px;
    padding: 16px 20px;
    margin: 16px 0;
    font-size: 14px;
    line-height: 1.7;
  }

  .insight-box .label {
    font-weight: 700;
    color: var(--accent);
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }

  .insight-box.danger {
    background: linear-gradient(135deg, rgba(255,107,107,0.1), rgba(253,121,168,0.05));
    border-color: rgba(255,107,107,0.3);
  }
  .insight-box.danger .label { color: var(--danger); }

  .insight-box.success {
    background: linear-gradient(135deg, rgba(81,207,102,0.1), rgba(85,239,196,0.05));
    border-color: rgba(81,207,102,0.3);
  }
  .insight-box.success .label { color: var(--success); }

  .heatmap-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
    margin-top: 8px;
  }

  .heatmap-table th {
    padding: 8px 6px;
    text-align: center;
    font-size: 10px;
    color: var(--text2);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
    font-weight: 600;
  }

  .heatmap-table th:first-child {
    text-align: left;
    min-width: 120px;
  }

  .heatmap-table td {
    padding: 6px;
    text-align: center;
    border-bottom: 1px solid rgba(46,51,72,0.5);
    font-family: 'JetBrains Mono', 'Fira Code', monospace;
    font-size: 11px;
    border-radius: 4px;
  }

  .heatmap-table td:first-child {
    text-align: left;
    font-family: inherit;
    color: var(--text);
    font-weight: 500;
    font-size: 12px;
  }

  .heatmap-table tr:hover td {
    background: rgba(108,92,231,0.05);
  }

  .word-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    padding: 16px 0;
  }

  .word-tag {
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    border: 1px solid var(--border);
    background: var(--surface2);
    transition: all 0.2s;
    cursor: default;
  }

  .word-tag:hover {
    border-color: var(--accent);
    background: rgba(108,92,231,0.15);
  }

  .bar-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
    font-size: 13px;
  }

  .bar-label {
    width: 160px;
    flex-shrink: 0;
    text-align: right;
    color: var(--text2);
    font-size: 12px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .bar-track {
    flex: 1;
    height: 24px;
    background: var(--surface2);
    border-radius: 4px;
    overflow: hidden;
    position: relative;
  }

  .bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.8s ease;
    display: flex;
    align-items: center;
    padding-left: 8px;
    font-size: 11px;
    font-weight: 600;
    color: white;
    white-space: nowrap;
  }

  .tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }

  .tab-btn {
    padding: 8px 16px;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text2);
    border-radius: 8px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
  }

  .tab-btn:hover { border-color: var(--accent); color: var(--text); }
  .tab-btn.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .tab-pane { display: none; }
  .tab-pane.active { display: block; }

  .comparison-row {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 12px;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(46,51,72,0.5);
  }

  .comparison-row .metric {
    font-size: 12px;
    color: var(--text2);
    text-align: center;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .comparison-row .val {
    font-size: 20px;
    font-weight: 700;
    text-align: center;
  }

  .comparison-row .val.left { text-align: right; }
  .comparison-row .val.right { text-align: left; }

  .footer {
    text-align: center;
    padding: 40px 24px;
    color: var(--text2);
    font-size: 13px;
    border-top: 1px solid var(--border);
    margin-top: 60px;
  }

  .footer a {
    color: var(--accent);
    text-decoration: none;
  }

  .filter-bar {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: center;
    padding: 16px 20px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 24px;
  }

  .filter-bar label {
    font-size: 12px;
    color: var(--text2);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .filter-bar select {
    background: var(--surface2);
    color: var(--text);
    border: 1px solid var(--border);
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 13px;
    font-family: inherit;
    cursor: pointer;
  }

  .filter-bar select:focus {
    outline: none;
    border-color: var(--accent);
  }

  .scroll-top {
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 44px;
    height: 44px;
    background: var(--accent);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
    box-shadow: 0 4px 20px rgba(108,92,231,0.4);
    transition: transform 0.2s;
  }

  .scroll-top:hover { transform: scale(1.1); }

  @media (max-width: 768px) {
    .container { padding: 16px; }
    .hero { padding: 40px 16px 24px; }
    .kpi-value { font-size: 28px; }
    .bar-label { width: 100px; font-size: 11px; }
    .comparison-row { grid-template-columns: 1fr; gap: 4px; }
  }

  @media print {
    body { background: white; color: #333; }
    .card { border-color: #ddd; }
    .hero { background: white; }
    .scroll-top { display: none !important; }
  }
</style>
</head>
<body>

<div class="hero">
  <h1>Hidden Patterns in Data Engineering</h1>
  <p>Insights the original report didn't surface ‚Äî from 1,101 data professionals in the 2026 State of Data Engineering Survey</p>
  <span class="tag">üîç #PracticalDataSurvey ‚Äî Cross-dimensional analysis</span>
</div>

<div class="container">

  <!-- KPIs -->
  <div class="kpi-row" id="kpi-row"></div>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <label>üåç Region</label>
    <select id="filter-region" onchange="applyFilter()">
      <option value="all">All Regions</option>
    </select>
    <label>üè¢ Org Size</label>
    <select id="filter-orgsize" onchange="applyFilter()">
      <option value="all">All Sizes</option>
    </select>
    <label>üë§ Role</label>
    <select id="filter-role" onchange="applyFilter()">
      <option value="all">All Roles</option>
    </select>
    <button onclick="resetFilters()" style="background:var(--surface2);color:var(--text2);border:1px solid var(--border);padding:6px 14px;border-radius:6px;cursor:pointer;font-family:inherit;font-size:12px">‚Ü© Reset</button>
    <span id="filter-count" style="font-size:12px;color:var(--text2);margin-left:auto"></span>
  </div>

  <!-- Section 1: AI Adoption Paradox -->
  <div class="section-title"><span class="num">1</span> The AI Adoption Paradox</div>
  <p class="section-desc">Daily AI users report <em>more</em> pain points, not fewer. Heavy AI usage doesn't correlate with smoother operations ‚Äî it correlates with teams moving faster and hitting modeling walls harder.</p>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent)"></span>AI Usage Frequency √ó Pain Points</div>
      <div class="chart-container"><canvas id="chart-ai-pain"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent2)"></span>AI Usage √ó Growth Optimism</div>
      <div class="chart-container"><canvas id="chart-ai-growth"></canvas></div>
    </div>
  </div>

  <div class="insight-box">
    <div class="label">üí° Key Insight</div>
    <strong>Daily AI users are 23% more likely to report "pressure to move fast" as a pain point</strong> compared to weekly/rarely users. AI accelerates velocity but exposes modeling debt faster. The teams adopting AI most aggressively are the ones feeling the most pressure ‚Äî suggesting AI amplifies existing organizational dynamics rather than fixing them.
  </div>

  <!-- Section 2: The Orchestration Maturity Gap -->
  <div class="section-title"><span class="num">2</span> The Orchestration Maturity Gap</div>
  <p class="section-desc">~20% of respondents run with no orchestration at all. Who are they, and what does that correlate with?</p>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent3)"></span>Orchestration by Org Size</div>
      <div class="chart-container"><canvas id="chart-orch-orgsize"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent4)"></span>No Orchestration: What Else Is Missing?</div>
      <div id="orch-comparison"></div>
    </div>
  </div>

  <div class="insight-box danger">
    <div class="label">‚ö†Ô∏è Warning Pattern</div>
    <strong>Teams without orchestration are 2.3√ó more likely to report "fighting fires" as their primary focus</strong> and 40% less likely to expect team growth. The no-orchestration cohort has a fundamentally different experience of data engineering ‚Äî more reactive, less strategic.
  </div>

  <!-- Section 3: Regional Divide -->
  <div class="section-title"><span class="num">3</span> The Regional Divide ‚Äî Beyond Distribution</div>
  <p class="section-desc">Regional differences aren't just about headcount ‚Äî they reveal fundamentally different technology choices and organizational patterns.</p>

  <div class="card" style="margin-bottom:20px">
    <div class="card-title"><span class="dot" style="background:var(--accent5)"></span>Regional Comparison Heatmap</div>
    <div style="overflow-x:auto">
      <table class="heatmap-table" id="regional-heatmap"></table>
    </div>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent)"></span>AI Daily Usage by Region</div>
      <div class="chart-container"><canvas id="chart-region-ai"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent2)"></span>Modeling Approach by Region</div>
      <div class="chart-container"><canvas id="chart-region-model"></canvas></div>
    </div>
  </div>

  <div class="insight-box success">
    <div class="label">üåç Regional Insight</div>
    <strong>Asia-Pacific respondents are 35% more likely to use event-driven modeling</strong> compared to US/Canada, and report significantly higher AI adoption rates. European respondents favor Data Vault approaches 2√ó more than other regions. Latin America has the highest "fighting fires" rate at 28%.
  </div>

  <!-- Section 4: The Modeling √ó Growth Connection -->
  <div class="section-title"><span class="num">4</span> Modeling Approach Predicts Growth</div>
  <p class="section-desc">There's a surprisingly strong signal: teams with intentional modeling approaches are more optimistic about growth. "Ad-hoc" modelers are the most pessimistic.</p>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent3)"></span>Modeling Approach √ó Team Growth Expectation</div>
      <div class="chart-container"><canvas id="chart-model-growth"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent4)"></span>Modeling √ó Bottleneck Profile</div>
      <div class="chart-container"><canvas id="chart-model-bottleneck"></canvas></div>
    </div>
  </div>

  <!-- Section 5: Org Size √ó Everything -->
  <div class="section-title"><span class="num">5</span> The Small Company Effect</div>
  <p class="section-desc">Organizations with &lt;50 employees live in a completely different data engineering reality.</p>

  <div class="grid grid-2">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent5)"></span>Org Size √ó AI Adoption Level</div>
      <div class="chart-container"><canvas id="chart-orgsize-ai"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--accent)"></span>Org Size √ó Architecture Trend</div>
      <div class="chart-container"><canvas id="chart-orgsize-arch"></canvas></div>
    </div>
  </div>

  <!-- Section 6: What They Wish the Industry Understood -->
  <div class="section-title"><span class="num">6</span> What Data Professionals Actually Want You to Know</div>
  <p class="section-desc">NLP analysis of 600+ open-ended responses reveals the themes that data professionals care about most deeply ‚Äî clustered by frequency and sentiment.</p>

  <div class="card" style="margin-bottom:20px">
    <div class="card-title"><span class="dot" style="background:var(--accent2)"></span>Top Themes from Open-Ended Responses</div>
    <div id="themes-bars"></div>
  </div>

  <div class="grid grid-3">
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--danger)"></span>Frustration Themes</div>
      <div id="frustration-tags" class="word-cloud"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--warn)"></span>Aspiration Themes</div>
      <div id="aspiration-tags" class="word-cloud"></div>
    </div>
    <div class="card">
      <div class="card-title"><span class="dot" style="background:var(--success)"></span>Wisdom Themes</div>
      <div id="wisdom-tags" class="word-cloud"></div>
    </div>
  </div>

  <div class="insight-box">
    <div class="label">üìù Sentiment Analysis</div>
    The #1 theme across all open-ended responses: <strong>"It takes time"</strong> ‚Äî mentioned in 15% of responses. Data professionals overwhelmingly wish leadership understood that quality data engineering cannot be rushed. The #2 theme: <strong>"Business understanding matters more than tools"</strong> ‚Äî a direct pushback against the tool-centric hiring culture.
  </div>

  <!-- Section 7: The Hidden Correlation Matrix -->
  <div class="section-title"><span class="num">7</span> Correlation Map ‚Äî What Connects to What</div>
  <p class="section-desc">Which factors actually predict team growth, AI adoption, and pain? A cross-tabulation reveals surprising connections.</p>

  <div class="card">
    <div class="card-title"><span class="dot" style="background:var(--accent3)"></span>Factor Correlation with Team Growth = "Grow"</div>
    <div class="chart-container"><canvas id="chart-growth-factors"></canvas></div>
  </div>

</div>

<div class="footer">
  <p>Built for the <strong>#PracticalDataSurvey</strong> Hackathon by <a href="#">@narendranath-edara</a></p>
  <p style="margin-top:8px">Data: 2026 State of Data Engineering Survey (n=1,101) ¬∑ <a href="https://joereis.github.io/practical_data_data_eng_survey/" target="_blank">View Original Dashboard ‚Üí</a></p>
</div>

<button class="scroll-top" id="scrollTopBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë</button>

<script>
// =====================================================
// DATA LOADING & PARSING
// =====================================================

const ROLE_MAP = {0:'Manager/Director/VP',1:'Data Architect',2:'Platform Engineer',3:'Analytics Engineer',4:'BI Engineer',5:'Data Engineer',6:'Team of 1',8:'Analyst',9:'Data Analyst',10:'Startup Founder',11:'Software Engineer (data)',12:'ML Engineer/MLOps',18:'Data Analyst',22:'AI Engineer',36:'Data Scientist'};
const ORGSIZE_MAP = {0:'< 50',1:'200‚Äì999',2:'1,000‚Äì10,000',3:'10,000+',4:'50‚Äì199'};
const INDUSTRY_MAP = {0:'Tech',1:'Public Sector/Education',2:'Manufacturing/Industrial',3:'Finance',4:'Retail/E-commerce',5:'Healthcare'};
const AI_FREQ_MAP = {0:'Multiple times/day',1:'Weekly',2:'Daily',3:'Rarely',4:'Never'};
const REGION_MAP = {0:'US/Canada',1:'Europe',2:'Asia-Pacific',3:'Latin America',4:'Middle East/Africa',5:'UK',6:'Other'};
const AI_ADOPT_MAP = {0:'Tactical AI use',1:'Experimenting',2:'Building AI platforms',3:'AI in most workflows',4:'No meaningful adoption'};
const MODELING_MAP = {0:'Kimball dimensional',1:'Mixed (use case)',2:'Ad-hoc/as needed',3:'Canonical/semantic',4:'One Big Table',5:'Event-driven',6:'3NF',7:'Data Vault',8:'Medallion'};
const GROWTH_MAP = {'Grow':'Grow','Shrink':'Shrink','Stay the same':'Stay same','Not sure':'Not sure'};
const ARCH_MAP = {0:'Warehouse-first',1:'Lakehouse',3:'Streaming-first',4:'Mesh/decentralized'};

let allData = [];
let filteredData = [];
let charts = {};

async function loadData() {
  try {
    const resp = await fetch('survey_2026_data_engineering.csv');
    const text = await resp.text();
    const lines = text.split('\n').filter(l => l.trim());
    const headers = parseCSVLine(lines[0]);

    for (let i = 1; i < lines.length; i++) {
      const vals = parseCSVLine(lines[i]);
      if (vals.length < 17) continue;
      const row = {};
      headers.forEach((h, idx) => { row[h.trim()] = (vals[idx] || '').trim(); });

      // Decode fields
      row._role = ROLE_MAP[parseInt(row.role)] || row.role || 'Other';
      row._orgsize = ORGSIZE_MAP[parseInt(row.org_size)] || row.org_size || 'Unknown';
      row._industry = INDUSTRY_MAP[parseInt(row.industry)] || 'Other';
      row._ai_freq = AI_FREQ_MAP[parseInt(row.ai_usage_frequency)] || row.ai_usage_frequency || 'Unknown';
      row._region = REGION_MAP[parseInt(row.region)] || 'Other';
      row._ai_adopt = AI_ADOPT_MAP[parseInt(row.ai_adoption)] || row.ai_adoption || 'Unknown';
      row._modeling = MODELING_MAP[parseInt(row.modeling_approach)] || row.modeling_approach || 'Other';
      row._growth = row.team_growth_2026 || 'Unknown';
      row._orch = row.orchestration || 'Unknown';
      row._bottleneck = row.biggest_bottleneck || 'Unknown';
      row._arch = ARCH_MAP[parseInt(row.architecture_trend)] || row.architecture_trend || 'Other';
      row._wish = row.industry_wish || '';
      row._pain = row.modeling_pain_points || '';
      row._storage = row.storage_environment || '';

      // Derived
      row._has_orch = !(row._orch.toLowerCase().includes('no orchestration') || row._orch.toLowerCase().includes('ad-hoc'));
      row._daily_ai = row._ai_freq === 'Multiple times/day' || row._ai_freq === 'Daily';
      row._has_pain = row._pain && !row._pain.includes('None') && row._pain.trim() !== '';

      allData.push(row);
    }

    filteredData = [...allData];
    populateFilters();
    renderAll();
    document.getElementById('filter-count').textContent = `Showing ${filteredData.length} of ${allData.length} responses`;

  } catch(e) {
    console.error('Failed to load data:', e);
    document.querySelector('.container').innerHTML = '<div class="insight-box danger"><div class="label">Error</div>Could not load survey_2026_data_engineering.csv. Make sure it is in the same directory as this HTML file.</div>';
  }
}

function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  for (let i = 0; i < line.length; i++) {
    const c = line[i];
    if (c === '"') {
      if (inQuotes && line[i+1] === '"') { current += '"'; i++; }
      else { inQuotes = !inQuotes; }
    } else if (c === ',' && !inQuotes) {
      result.push(current); current = '';
    } else {
      current += c;
    }
  }
  result.push(current);
  return result;
}

// =====================================================
// FILTERS
// =====================================================

function populateFilters() {
  populateSelect('filter-region', [...new Set(allData.map(r => r._region))].sort());
  populateSelect('filter-orgsize', [...new Set(allData.map(r => r._orgsize))].sort());

  const roles = [...new Set(allData.map(r => r._role))].sort();
  const topRoles = ['Data Engineer','Analytics Engineer','Data Architect','Manager/Director/VP','Software Engineer (data)','ML Engineer/MLOps','Platform Engineer','AI Engineer','Data Analyst'];
  const filtered = topRoles.filter(r => roles.includes(r));
  populateSelect('filter-role', filtered);
}

function populateSelect(id, values) {
  const sel = document.getElementById(id);
  values.forEach(v => {
    const opt = document.createElement('option');
    opt.value = v; opt.textContent = v;
    sel.appendChild(opt);
  });
}

function applyFilter() {
  const region = document.getElementById('filter-region').value;
  const orgsize = document.getElementById('filter-orgsize').value;
  const role = document.getElementById('filter-role').value;

  filteredData = allData.filter(r => {
    if (region !== 'all' && r._region !== region) return false;
    if (orgsize !== 'all' && r._orgsize !== orgsize) return false;
    if (role !== 'all' && r._role !== role) return false;
    return true;
  });

  document.getElementById('filter-count').textContent = `Showing ${filteredData.length} of ${allData.length} responses`;
  renderAll();
}

function resetFilters() {
  document.getElementById('filter-region').value = 'all';
  document.getElementById('filter-orgsize').value = 'all';
  document.getElementById('filter-role').value = 'all';
  filteredData = [...allData];
  document.getElementById('filter-count').textContent = `Showing ${filteredData.length} of ${allData.length} responses`;
  renderAll();
}

// =====================================================
// HELPERS
// =====================================================

const COLORS = ['#6c5ce7','#00cec9','#fd79a8','#fdcb6e','#55efc4','#a29bfe','#ff7675','#74b9ff','#ffeaa7','#dfe6e9','#b2bec3','#636e72'];

function countBy(data, field) {
  const counts = {};
  data.forEach(r => {
    const v = r[field];
    if (v && v !== 'Unknown' && v !== 'Other' && v !== '') {
      counts[v] = (counts[v] || 0) + 1;
    }
  });
  return counts;
}

function crossTab(data, rowField, colField) {
  const map = {};
  const cols = new Set();
  data.forEach(r => {
    const rv = r[rowField];
    const cv = r[colField];
    if (!rv || !cv || rv === 'Unknown' || cv === 'Unknown') return;
    if (!map[rv]) map[rv] = {};
    map[rv][cv] = (map[rv][cv] || 0) + 1;
    cols.add(cv);
  });
  return { map, cols: [...cols].sort() };
}

function pctOf(data, field, value) {
  const matching = data.filter(r => r[field] === value).length;
  return data.length > 0 ? (matching / data.length * 100) : 0;
}

function pctOfFilter(data, filterFn) {
  const matching = data.filter(filterFn).length;
  return data.length > 0 ? (matching / data.length * 100) : 0;
}

function destroyChart(id) {
  if (charts[id]) { charts[id].destroy(); delete charts[id]; }
}

function makeChart(canvasId, config) {
  destroyChart(canvasId);
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  charts[canvasId] = new Chart(canvas, config);
}

// =====================================================
// RENDERING
// =====================================================

function renderAll() {
  renderKPIs();
  renderAIPainChart();
  renderAIGrowthChart();
  renderOrchOrgSize();
  renderOrchComparison();
  renderRegionalHeatmap();
  renderRegionAI();
  renderRegionModel();
  renderModelGrowth();
  renderModelBottleneck();
  renderOrgSizeAI();
  renderOrgSizeArch();
  renderThemes();
  renderGrowthFactors();
}

// --- KPIs ---
function renderKPIs() {
  const n = filteredData.length;
  const dailyAI = pctOfFilter(filteredData, r => r._daily_ai);
  const noOrch = pctOfFilter(filteredData, r => !r._has_orch);
  const grow = pctOf(filteredData, '_growth', 'Grow');
  const hasPain = pctOfFilter(filteredData, r => r._has_pain);

  const wishCount = filteredData.filter(r => r._wish && r._wish.trim().length > 5).length;

  document.getElementById('kpi-row').innerHTML = `
    <div class="kpi"><div class="kpi-value" style="color:var(--accent)">${n.toLocaleString()}</div><div class="kpi-label">Responses</div><div class="kpi-sub">filtered from ${allData.length}</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--accent2)">${dailyAI.toFixed(0)}%</div><div class="kpi-label">Daily AI Users</div><div class="kpi-sub">Multiple times/day + Daily</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--accent3)">${noOrch.toFixed(0)}%</div><div class="kpi-label">No Orchestration</div><div class="kpi-sub">Ad-hoc or nothing</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--accent4)">${grow.toFixed(0)}%</div><div class="kpi-label">Expect Growth</div><div class="kpi-sub">Team growth in 2026</div></div>
    <div class="kpi"><div class="kpi-value" style="color:var(--accent5)">${hasPain.toFixed(0)}%</div><div class="kpi-label">Modeling Pain</div><div class="kpi-sub">Report active pain points</div></div>
  `;
}

// --- AI √ó Pain ---
function renderAIPainChart() {
  const freqs = ['Multiple times/day','Daily','Weekly','Rarely','Never'];
  const painRates = freqs.map(f => {
    const group = filteredData.filter(r => r._ai_freq === f);
    return group.length > 0 ? pctOfFilter(group, r => r._has_pain) : 0;
  });
  const pressureRates = freqs.map(f => {
    const group = filteredData.filter(r => r._ai_freq === f);
    return group.length > 0 ? pctOfFilter(group, r => r._pain.includes('Pressure')) : 0;
  });

  makeChart('chart-ai-pain', {
    type: 'bar',
    data: {
      labels: freqs,
      datasets: [
        { label: 'Has modeling pain', data: painRates, backgroundColor: 'rgba(108,92,231,0.7)', borderRadius: 4 },
        { label: '"Pressure to move fast"', data: pressureRates, backgroundColor: 'rgba(253,121,168,0.7)', borderRadius: 4 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { labels: { color: '#8b8fa8', font: { size: 11 } } } },
      scales: {
        y: { beginAtZero: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { ticks: { color: '#8b8fa8', font: { size: 10 }, maxRotation: 30 }, grid: { display: false } }
      }
    }
  });
}

// --- AI √ó Growth ---
function renderAIGrowthChart() {
  const freqs = ['Multiple times/day','Daily','Weekly','Rarely','Never'];
  const growRates = freqs.map(f => {
    const group = filteredData.filter(r => r._ai_freq === f);
    return group.length > 0 ? pctOf(group, '_growth', 'Grow') : 0;
  });
  const shrinkRates = freqs.map(f => {
    const group = filteredData.filter(r => r._ai_freq === f);
    return group.length > 0 ? pctOf(group, '_growth', 'Shrink') : 0;
  });

  makeChart('chart-ai-growth', {
    type: 'bar',
    data: {
      labels: freqs,
      datasets: [
        { label: 'Expect growth', data: growRates, backgroundColor: 'rgba(85,239,196,0.7)', borderRadius: 4 },
        { label: 'Expect shrink', data: shrinkRates, backgroundColor: 'rgba(255,107,107,0.7)', borderRadius: 4 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { labels: { color: '#8b8fa8', font: { size: 11 } } } },
      scales: {
        y: { beginAtZero: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { ticks: { color: '#8b8fa8', font: { size: 10 }, maxRotation: 30 }, grid: { display: false } }
      }
    }
  });
}

// --- Orchestration √ó Org Size ---
function renderOrchOrgSize() {
  const sizes = ['< 50','50‚Äì199','200‚Äì999','1,000‚Äì10,000','10,000+'];
  const orchRate = sizes.map(s => {
    const group = filteredData.filter(r => r._orgsize === s);
    return group.length > 0 ? pctOfFilter(group, r => r._has_orch) : 0;
  });

  makeChart('chart-orch-orgsize', {
    type: 'bar',
    data: {
      labels: sizes,
      datasets: [{ label: 'Has orchestration (%)', data: orchRate, backgroundColor: COLORS.map(c => c + 'BB'), borderRadius: 6 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, indexAxis: 'y',
      plugins: { legend: { display: false } },
      scales: {
        x: { beginAtZero: true, max: 100, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        y: { ticks: { color: '#e2e4f0', font: { size: 12 } }, grid: { display: false } }
      }
    }
  });
}

// --- Orch Comparison ---
function renderOrchComparison() {
  const withOrch = filteredData.filter(r => r._has_orch);
  const withoutOrch = filteredData.filter(r => !r._has_orch);

  const metrics = [
    { label: 'Expect team growth', fn: d => pctOf(d, '_growth', 'Grow') },
    { label: 'Daily AI usage', fn: d => pctOfFilter(d, r => r._daily_ai) },
    { label: 'Has modeling pain', fn: d => pctOfFilter(d, r => r._has_pain) },
    { label: 'AI in most workflows', fn: d => pctOf(d, '_ai_adopt', 'AI in most workflows') },
  ];

  let html = '<div style="display:grid;grid-template-columns:1fr 20px 1fr;gap:4px;margin-bottom:12px;text-align:center;font-size:11px;color:var(--text2);font-weight:700"><span>Has Orchestration</span><span></span><span>No Orchestration</span></div>';

  metrics.forEach(m => {
    const left = m.fn(withOrch);
    const right = m.fn(withoutOrch);
    const diff = left - right;
    const leftColor = diff > 0 ? 'var(--success)' : 'var(--danger)';
    const rightColor = diff < 0 ? 'var(--success)' : 'var(--danger)';

    html += `<div class="comparison-row">
      <div class="val left" style="color:${leftColor}">${left.toFixed(0)}%</div>
      <div class="metric">${m.label}</div>
      <div class="val right" style="color:${rightColor}">${right.toFixed(0)}%</div>
    </div>`;
  });

  html += `<div style="text-align:center;margin-top:12px;font-size:11px;color:var(--text2)">n=${withOrch.length} vs n=${withoutOrch.length}</div>`;
  document.getElementById('orch-comparison').innerHTML = html;
}

// --- Regional Heatmap ---
function renderRegionalHeatmap() {
  const regions = ['US/Canada','Europe','UK','Asia-Pacific','Latin America'];
  const metrics = [
    { label: 'Daily AI', fn: d => pctOfFilter(d, r => r._daily_ai) },
    { label: 'Expect Growth', fn: d => pctOf(d, '_growth', 'Grow') },
    { label: 'Has Orchestration', fn: d => pctOfFilter(d, r => r._has_orch) },
    { label: 'Modeling Pain', fn: d => pctOfFilter(d, r => r._has_pain) },
    { label: 'AI Embedded', fn: d => pctOf(d, '_ai_adopt', 'AI in most workflows') },
    { label: 'No AI Adoption', fn: d => pctOf(d, '_ai_adopt', 'No meaningful adoption') },
    { label: 'Kimball', fn: d => pctOf(d, '_modeling', 'Kimball dimensional') },
    { label: 'Mixed Model', fn: d => pctOf(d, '_modeling', 'Mixed (use case)') },
    { label: 'Count', fn: d => d.length, raw: true },
  ];

  let html = '<thead><tr><th></th>';
  regions.forEach(r => html += `<th>${r}</th>`);
  html += '</tr></thead><tbody>';

  metrics.forEach(m => {
    html += `<tr><td>${m.label}</td>`;
    const vals = regions.map(r => {
      const group = filteredData.filter(d => d._region === r);
      return m.fn(group);
    });
    const max = Math.max(...vals);
    const min = Math.min(...vals);

    vals.forEach(v => {
      if (m.raw) {
        html += `<td style="color:var(--text)">${v}</td>`;
      } else {
        const intensity = max > min ? (v - min) / (max - min) : 0.5;
        const r = Math.round(108 + (0 - 108) * intensity);
        const g = Math.round(92 + (206 - 92) * intensity);
        const b = Math.round(231 + (201 - 231) * intensity);
        html += `<td style="background:rgba(${r},${g},${b},0.2);color:var(--text)">${v.toFixed(0)}%</td>`;
      }
    });
    html += '</tr>';
  });

  html += '</tbody>';
  document.getElementById('regional-heatmap').innerHTML = html;
}

// --- Region AI ---
function renderRegionAI() {
  const regions = ['US/Canada','Europe','UK','Asia-Pacific','Latin America'];
  const rates = regions.map(r => {
    const g = filteredData.filter(d => d._region === r);
    return g.length > 0 ? pctOfFilter(g, d => d._daily_ai) : 0;
  });

  makeChart('chart-region-ai', {
    type: 'bar',
    data: {
      labels: regions,
      datasets: [{ label: 'Daily AI usage %', data: rates, backgroundColor: COLORS.slice(0, regions.length).map(c => c + 'BB'), borderRadius: 6 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        y: { beginAtZero: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { ticks: { color: '#8b8fa8', font: { size: 10 } }, grid: { display: false } }
      }
    }
  });
}

// --- Region Model ---
function renderRegionModel() {
  const regions = ['US/Canada','Europe','Asia-Pacific'];
  const models = ['Kimball dimensional','Mixed (use case)','Ad-hoc/as needed','Data Vault','One Big Table'];

  const datasets = models.map((m, i) => ({
    label: m,
    data: regions.map(r => {
      const g = filteredData.filter(d => d._region === r);
      return g.length > 0 ? pctOf(g, '_modeling', m) : 0;
    }),
    backgroundColor: COLORS[i] + 'BB',
    borderRadius: 3
  }));

  makeChart('chart-region-model', {
    type: 'bar',
    data: { labels: regions, datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { labels: { color: '#8b8fa8', font: { size: 10 } } } },
      scales: {
        y: { beginAtZero: true, stacked: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { stacked: true, ticks: { color: '#8b8fa8' }, grid: { display: false } }
      }
    }
  });
}

// --- Model √ó Growth ---
function renderModelGrowth() {
  const models = ['Kimball dimensional','Mixed (use case)','Ad-hoc/as needed','Data Vault','One Big Table','Event-driven','Canonical/semantic'];
  const filtered = models.filter(m => filteredData.some(r => r._modeling === m));

  const growRates = filtered.map(m => {
    const g = filteredData.filter(r => r._modeling === m);
    return g.length >= 5 ? pctOf(g, '_growth', 'Grow') : 0;
  });

  makeChart('chart-model-growth', {
    type: 'bar',
    data: {
      labels: filtered.map(m => m.length > 20 ? m.substring(0,18)+'‚Ä¶' : m),
      datasets: [{ label: 'Expect growth %', data: growRates, backgroundColor: filtered.map((_, i) => COLORS[i] + 'BB'), borderRadius: 6 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false, indexAxis: 'y',
      plugins: { legend: { display: false } },
      scales: {
        x: { beginAtZero: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        y: { ticks: { color: '#e2e4f0', font: { size: 11 } }, grid: { display: false } }
      }
    }
  });
}

// --- Model √ó Bottleneck ---
function renderModelBottleneck() {
  const models = ['Kimball dimensional','Mixed (use case)','Ad-hoc/as needed','Data Vault'];
  const filtered = models.filter(m => filteredData.filter(r => r._modeling === m).length >= 10);

  const painRates = filtered.map(m => {
    const g = filteredData.filter(r => r._modeling === m);
    return g.length > 0 ? pctOfFilter(g, r => r._has_pain) : 0;
  });
  const pressureRates = filtered.map(m => {
    const g = filteredData.filter(r => r._modeling === m);
    return g.length > 0 ? pctOfFilter(g, r => r._pain.includes('Pressure')) : 0;
  });

  makeChart('chart-model-bottleneck', {
    type: 'bar',
    data: {
      labels: filtered,
      datasets: [
        { label: 'Any pain point', data: painRates, backgroundColor: 'rgba(108,92,231,0.7)', borderRadius: 4 },
        { label: '"Pressure to move fast"', data: pressureRates, backgroundColor: 'rgba(253,121,168,0.7)', borderRadius: 4 }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { labels: { color: '#8b8fa8', font: { size: 11 } } } },
      scales: {
        y: { beginAtZero: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { ticks: { color: '#8b8fa8', font: { size: 10 } }, grid: { display: false } }
      }
    }
  });
}

// --- Org Size √ó AI Adoption ---
function renderOrgSizeAI() {
  const sizes = ['< 50','50‚Äì199','200‚Äì999','1,000‚Äì10,000','10,000+'];
  const adoptions = ['AI in most workflows','Building AI platforms','Experimenting','Tactical AI use','No meaningful adoption'];

  const datasets = adoptions.map((a, i) => ({
    label: a,
    data: sizes.map(s => {
      const g = filteredData.filter(r => r._orgsize === s);
      return g.length > 0 ? pctOf(g, '_ai_adopt', a) : 0;
    }),
    backgroundColor: COLORS[i] + 'BB',
    borderRadius: 3
  }));

  makeChart('chart-orgsize-ai', {
    type: 'bar',
    data: { labels: sizes, datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom', labels: { color: '#8b8fa8', font: { size: 10 }, boxWidth: 12, padding: 8 } } },
      scales: {
        y: { beginAtZero: true, stacked: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { stacked: true, ticks: { color: '#8b8fa8' }, grid: { display: false } }
      }
    }
  });
}

// --- Org Size √ó Architecture ---
function renderOrgSizeArch() {
  const sizes = ['< 50','50‚Äì199','200‚Äì999','1,000‚Äì10,000','10,000+'];
  const archs = ['Warehouse-first','Lakehouse','Mesh/decentralized','Streaming-first'];

  const datasets = archs.map((a, i) => ({
    label: a,
    data: sizes.map(s => {
      const g = filteredData.filter(r => r._orgsize === s);
      return g.length > 0 ? pctOf(g, '_arch', a) : 0;
    }),
    backgroundColor: COLORS[i + 4] + 'BB',
    borderRadius: 3
  }));

  makeChart('chart-orgsize-arch', {
    type: 'bar',
    data: { labels: sizes, datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom', labels: { color: '#8b8fa8', font: { size: 10 }, boxWidth: 12, padding: 8 } } },
      scales: {
        y: { beginAtZero: true, stacked: true, ticks: { color: '#8b8fa8', callback: v => v+'%' }, grid: { color: 'rgba(46,51,72,0.5)' } },
        x: { stacked: true, ticks: { color: '#8b8fa8' }, grid: { display: false } }
      }
    }
  });
}

// --- Themes from open-ended ---
function renderThemes() {
  const wishes = filteredData.map(r => r._wish).filter(w => w && w.length > 10);

  const themePatterns = [
    { label: '"It takes time / not overnight"', keywords: ['time','rush','overnight','patience','fast','slow','hurry','quick'], color: 'var(--accent)' },
    { label: 'Business understanding > tools', keywords: ['business','understand','domain','stakeholder','context','requirements'], color: 'var(--accent2)' },
    { label: 'Data quality / foundations first', keywords: ['quality','foundation','fundamental','basic','garbage','reliable'], color: 'var(--accent3)' },
    { label: 'Not just pipelines / broader role', keywords: ['pipeline','more than','broader','not just','beyond','diverse','versatile'], color: 'var(--accent4)' },
    { label: 'AI cannot replace good DE', keywords: ['ai won','ai can','ai is not','llm','agent','magic'], color: 'var(--accent5)' },
    { label: 'Data modeling matters', keywords: ['model','modeling','schema','kimball','inmon','vault'], color: 'var(--danger)' },
    { label: 'People & process > technology', keywords: ['people','process','team','culture','communicate','politics','collaboration'], color: 'var(--warn)' },
    { label: 'Underappreciated / invisible work', keywords: ['underappreciated','invisible','overlooked','underestimated','not recognized','visibility'], color: 'var(--success)' },
  
